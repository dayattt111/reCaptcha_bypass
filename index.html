<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Demo Form dengan CAPTCHA</title>
  <style>
    :root{--bg:#f4f6f8;--card:#ffffff;--accent:#2563eb;--muted:#6b7280}
    *{box-sizing:border-box}
    body{font-family:Inter,ui-sans-serif,system-ui,Segoe UI,Roboto,Helvetica,Arial; background:var(--bg); margin:0; padding:40px; color:#111}
    .wrap{max-width:520px;margin:0 auto}
    .card{background:var(--card);padding:24px;border-radius:12px;box-shadow:0 6px 18px rgba(16,24,40,0.06)}
    h1{font-size:20px;margin:0 0 12px}
    p.lead{margin:0 0 18px;color:var(--muted)}

    form .field{margin-bottom:14px}
    label{display:block;font-size:13px;margin-bottom:6px;color:var(--muted)}
    input[type="text"], input[type="email"]{width:100%;padding:10px 12px;border-radius:8px;border:1px solid #e6e9ef;font-size:14px}

    .captcha-row{display:flex;gap:12px;align-items:center}
    canvas#captchaCanvas{border-radius:8px;border:1px solid #e6e9ef;background:#fff}
    .small{font-size:13px;color:var(--muted)}

    .controls{display:flex;gap:8px}
    button{background:var(--accent);color:#fff;border:0;padding:10px 12px;border-radius:8px;cursor:pointer}
    button.ghost{background:#fff;border:1px solid #e6e9ef;color:#111}
    .hint{font-size:12px;color:#ef4444;margin-top:6px}

    .success{background:#ecfdf5;border:1px solid #bbf7d0;color:#065f46;padding:10px;border-radius:8px;margin-top:12px}
    .error{background:#fff7f5;border:1px solid #ffccc7;color:#9b1c1c;padding:10px;border-radius:8px;margin-top:12px}

    footer{margin-top:18px;font-size:12px;color:var(--muted);text-align:center}
    @media(max-width:520px){body{padding:18px}}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>Form Pendaftaran (dengan CAPTCHA)</h1>
      <p class="lead">Isi data lalu ketik karakter yang terlihat pada CAPTCHA. Klik "Refresh" bila sulit dibaca.</p>

      <form id="demoForm" autocomplete="off">
        <div class="field">
          <label for="name">Nama</label>
          <input id="name" name="name" type="text" required placeholder="Masukkan nama...">
        </div>

        <div class="field">
          <label for="email">Email</label>
          <input id="email" name="email" type="email" required placeholder="email@contoh.com">
        </div>

        <div class="field">
          <label for="captchaInput">CAPTCHA</label>
          <div class="captcha-row">
            <canvas id="captchaCanvas" width="220" height="70" aria-label="CAPTCHA image"></canvas>
            <div style="flex:1">
              <div class="controls">
                <button type="button" id="refreshBtn" class="ghost">Refresh</button>
                <button type="button" id="audioBtn" class="ghost">Audio</button>
              </div>
              <div style="height:8px"></div>
              <input id="captchaInput" name="captcha" type="text" placeholder="Ketik karakter di atas" required>
              <div id="captchaHint" class="small">Case-insensitive</div>
            </div>
          </div>
        </div>

        <div class="field">
          <button id="submitBtn" type="submit">Kirim</button>
          <button id="clearBtn" type="button" class="ghost">Kosongkan</button>
        </div>

        <div id="message" role="status" aria-live="polite"></div>
      </form>

      <footer>Demo CAPTCHA client-side — tidak untuk produksi. Untuk verifikasi aman gunakan server-side atau reCAPTCHA.</footer>
    </div>
  </div>

  <script>
    // Simple client-side CAPTCHA using Canvas
    (function(){
      const canvas = document.getElementById('captchaCanvas');
      const ctx = canvas.getContext('2d');
      const refreshBtn = document.getElementById('refreshBtn');
      const audioBtn = document.getElementById('audioBtn');
      const input = document.getElementById('captchaInput');
      const form = document.getElementById('demoForm');
      const msg = document.getElementById('message');

      let currentCaptcha = '';

      function randInt(min, max){ return Math.floor(Math.random()*(max-min+1))+min }
      function pickChars(n){
        const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789abcdefghjkmnpqrstuvwxyz'; // avoid ambiguous O0Il
        let s=''; for(let i=0;i<n;i++) s += chars.charAt(Math.floor(Math.random()*chars.length));
        return s;
      }

      function drawCaptcha(text){
        const w = canvas.width, h = canvas.height;
        ctx.clearRect(0,0,w,h);
        // background gradient
        const g = ctx.createLinearGradient(0,0,w,h);
        g.addColorStop(0,'#ffffff'); g.addColorStop(1,'#f3f4f6');
        ctx.fillStyle = g; ctx.fillRect(0,0,w,h);

        // Add noise lines
        for(let i=0;i<8;i++){
          ctx.beginPath();
          ctx.moveTo(randInt(0,w), randInt(0,h));
          ctx.lineTo(randInt(0,w), randInt(0,h));
          ctx.strokeStyle = `rgba(${randInt(50,120)},${randInt(50,120)},${randInt(50,120)},${(Math.random()*0.6).toFixed(2)})`;
          ctx.lineWidth = Math.random()*1.4+0.6; ctx.stroke();
        }

        // Draw each character with random transform
        const margin = 18; const availW = w - margin*2; const charW = availW / text.length;
        for(let i=0;i<text.length;i++){
          const ch = text[i];
          const fontSize = randInt(28,40);
          ctx.font = `${fontSize}px Arial`;
          ctx.save();
          const x = margin + i*charW + (charW - fontSize)/2 + randInt(-4,6);
          const y = h/2 + randInt(6,14);
          const angle = (Math.random()*30-15) * Math.PI/180;
          ctx.translate(x,y); ctx.rotate(angle);
          // slight skew via transform
          ctx.transform(1, Math.random()*0.15-0.07, Math.random()*0.15-0.07, 1, 0, 0);
          ctx.fillStyle = `rgba(${randInt(20,80)},${randInt(20,80)},${randInt(20,80)},1)`;
          ctx.fillText(ch, 0, 0);
          ctx.restore();
        }

        // dots
        for(let i=0;i<40;i++){
          ctx.beginPath(); ctx.arc(randInt(0,w), randInt(0,h), Math.random()*1.6, 0, Math.PI*2);
          ctx.fillStyle = `rgba(${randInt(80,200)},${randInt(80,200)},${randInt(80,200)},${(Math.random()*0.7).toFixed(2)})`;
          ctx.fill();
        }
      }

      function generate(){
        currentCaptcha = pickChars(6);
        drawCaptcha(currentCaptcha);
        input.value = '';
        msg.innerHTML = '';
      }

      refreshBtn.addEventListener('click', generate);

      // basic audio accessibility: speak the captcha using SpeechSynthesis
      audioBtn.addEventListener('click', ()=>{
        try{
          const utter = new SpeechSynthesisUtterance(currentCaptcha.split('').join(' '));
          utter.rate = 0.9; window.speechSynthesis.speak(utter);
        }catch(e){ alert('Audio tidak tersedia di browser ini.'); }
      });

      form.addEventListener('submit', function(e){
        e.preventDefault();
        const entered = input.value.trim();
        if(!entered){ showError('Isi CAPTCHA terlebih dahulu.'); return }
        if(entered.toLowerCase() === currentCaptcha.toLowerCase()){
          showSuccess('Berhasil! Formulir dikirim (demo).');
          // Simulate sending data — in produksi lakukan POST ke server
          form.reset(); generate();
        }else{
          showError('CAPTCHA salah — coba lagi.');
          input.focus();
        }
      });

      document.getElementById('clearBtn').addEventListener('click', ()=>{ form.reset(); msg.innerHTML=''; generate(); });

      function showSuccess(text){ msg.innerHTML = `<div class="success">${text}</div>` }
      function showError(text){ msg.innerHTML = `<div class="error">${text}</div>` }

      // initial
      generate();

      // prevent copy of captcha by keyboard selection on canvas (not full-proof)
      canvas.addEventListener('contextmenu', e=>e.preventDefault());
    })();
  </script>
</body>
</html>
